<!-- PERCEPTION WITH WIRE DETECTION AND TRACKING -->
<launch>
    <group>
        <push-ros-namespace namespace="perception" />
        
        <!-- State and depth estimation -->
        <!-- Camera is in optical frame. This is Z-forward, x right, y down.  -->
        <!-- the tf rotation applies in argument order (yaw first, then pitch, then roll) -->
        <node
            pkg="tf2_ros"
            exec="static_transform_publisher"
            name="static_transform_publisher"
            args="--x 0 --y 0 --z 0 --yaw 1.5708 --pitch -1.5708 --roll 3.14159 --frame-id camera_left --child-frame-id macvo_ned" />

        <node pkg="macvo_ros2" exec="macvo_node" namespace="macvo">
            <param name="macvo_config" value="$(find-pkg-share macvo_ros2)/config/MACVO_fast_for_orin.yaml"/>
            <param from="$(find-pkg-share macvo_ros2)/config/interface_config.yaml"/>
            <remap from="left/image_rect"
                to="/$(env ROBOT_NAME)/sensors/front_stereo/left/image_rect" />
            <remap from="right/image_rect"
                to="/$(env ROBOT_NAME)/sensors/front_stereo/right/image_rect" />
            <remap from="camera_info"
                to="/$(env ROBOT_NAME)/sensors/front_stereo/right/camera_info"  />
        </node>

        <!-- Wire Perception -->
        <group>
            <push-ros-namespace namespace="wire_perception" />
            
            <!-- Wire Detection -->
            <include file="$(find-pkg-share wire_perception)/launch/wire_detection.launch.py">
                <arg name="rgb_topic" value="/$(env ROBOT_NAME)/sensors/front_stereo/left/image_rect" />
                <arg name="depth_topic" value="/$(env ROBOT_NAME)/sensors/front_stereo/right/depth" />
                <arg name="camera_info_topic" value="/$(env ROBOT_NAME)/sensors/front_stereo/left/camera_info" />
                <arg name="detections_topic" value="/$(env ROBOT_NAME)/perception/wire_perception/wire_detections" />
            </include>
            
            <!-- Wire Tracking -->
            <include file="$(find-pkg-share wire_perception)/launch/wire_tracking.launch.py">
                <arg name="detections_topic" value="/$(env ROBOT_NAME)/perception/wire_perception/wire_detections" />
                <arg name="pose_topic" value="/$(env ROBOT_NAME)/odometry_conversion/odometry" />
                <arg name="target_topic" value="/$(env ROBOT_NAME)/perception/wire_perception/wire_target" />
            </include>
        </group>

    </group>

</launch>
